{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Laporan Laba Rugi</title>
    <link rel="stylesheet" href="{% static 'ledger/css/profit_loss.css' %}">
</head>
<body>

<h2>Laporan Laba Rugi</h2>

<!-- ========================= -->
<!-- FORM FILTER -->
<!-- ========================= -->
<form method="get" class="period-form">

    <!-- MODE -->
    <label>
        Mode:
        <select name="mode" onchange="this.form.submit()">
            <option value="period" {% if mode == 'period' %}selected{% endif %}>Bulanan</option>
            <option value="year" {% if mode == 'year' %}selected{% endif %}>Tahunan</option>
        </select>
    </label>

    <!-- PERIODE BULANAN -->
    {% if mode == 'period' %}
    <label>
        Periode (Closing):
        <select name="period" onchange="this.form.submit()">
            {% for period in closing_periods %}
                <option value="{{ period.period }}" {% if period.period == selected_period %}selected{% endif %}>
                    {{ period.period }}
                </option>
            {% endfor %}
        </select>
    </label>
    {% endif %}

    <!-- TAHUN -->
    {% if mode == 'year' %}
    <label>
        Tahun:
        <select name="year" onchange="this.form.submit()">
            {% for p in closing_periods %}
                {% with y=p.period|slice:":4" %}
                    <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>
                        {{ y }}
                    </option>
                {% endwith %}
            {% endfor %}
        </select>
    </label>
    {% endif %}

</form>

<!-- ========================= -->
<!-- INFO PERIODE -->
<!-- ========================= -->
<p style="margin: 10px 0;">
    <strong>Ditampilkan:</strong>
    {% if mode == 'year' %}
        Tahun {{ selected_year }}
    {% else %}
        Periode {{ selected_period }}
    {% endif %}
</p>

<!-- Wrapper horizontal -->
<div class="profit-loss-container">

    <!-- ========================= -->
    <!-- PENDAPATAN -->
    <!-- ========================= -->
    <div class="profit-section">
        <h3>Pendapatan</h3>
        {% for data in income_data %}
        <h4>{{ data.account.code }} - {{ data.account.account_name }}</h4>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Deskripsi</th>
                        <th class="text-right">Debit</th>
                        <th class="text-right">Credit</th>
                        <th class="text-right">Saldo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data.rows %}
                    <tr>
                        <td>{{ row.date }}</td>
                        <td>{{ row.desc }}</td>
                        <td class="text-right">{{ row.debit|floatformat:0|intcomma }}</td>
                        <td class="text-right">{{ row.credit|floatformat:0|intcomma }}</td>
                        <td class="text-right">{{ row.balance|floatformat:0|intcomma }}</td>
                    </tr>
                    {% endfor %}
                    <tr class="subtotal-row">
                        <td colspan="4">Subtotal Pendapatan</td>
                        <td class="text-right">{{ data.subtotal|floatformat:0|intcomma }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        {% endfor %}

        <div class="total-summary">
            Total Pendapatan:
            <strong>{{ total_income|floatformat:0|intcomma }}</strong>
        </div>
    </div>

    <!-- ========================= -->
    <!-- BEBAN -->
    <!-- ========================= -->
    <div class="profit-section">
        <h3>Pengeluaran</h3>
        {% for data in expense_data %}
        <h4>{{ data.account.code }} - {{ data.account.account_name }}</h4>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Deskripsi</th>
                        <th class="text-right">Debit</th>
                        <th class="text-right">Credit</th>
                        <th class="text-right">Saldo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data.rows %}
                    <tr>
                        <td>{{ row.date }}</td>
                        <td>{{ row.desc }}</td>
                        <td class="text-right">{{ row.debit|floatformat:0|intcomma }}</td>
                        <td class="text-right">{{ row.credit|floatformat:0|intcomma }}</td>
                        <td class="text-right">{{ row.balance|floatformat:0|intcomma }}</td>
                    </tr>
                    {% endfor %}
                    <tr class="subtotal-row">
                        <td colspan="4">Subtotal Pengeluaran</td>
                        <td class="text-right">{{ data.subtotal|floatformat:0|intcomma }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        {% endfor %}

        <div class="total-summary">
            Total Pengeluaran:
            <strong>{{ total_expense|floatformat:0|intcomma }}</strong>
        </div>
    </div>
</div>

<!-- ========================= -->
<!-- LABA RUGI BERSIH -->
<!-- ========================= -->
<div class="net-income">
    Laba / Rugi Bersih:
    <strong>{{ net_income|floatformat:0|intcomma }}</strong>
</div>

</body>
</html>
